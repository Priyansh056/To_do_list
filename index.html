1<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conference Chat - Multi User</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-container {
            width: 95%;
            max-width: 900px;
            height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 24px;
            font-weight: 600;
        }

        .chat-stats {
            text-align: right;
            font-size: 14px;
            opacity: 0.9;
        }

        .join-form {
            padding: 40px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .join-form h2 {
            margin-bottom: 30px;
            color: #333;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .name-input, .room-input {
            width: 100%;
            max-width: 350px;
            padding: 15px 20px;
            margin: 0 auto 15px;
            border: 2px solid #e1e8ed;
            border-radius: 50px;
            font-size: 16px;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
            display: block;
        }

        .name-input:focus, .room-input:focus {
            border-color: #4facfe;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }

        .join-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .join-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .chat-main {
            flex: 1;
            display: none;
            flex-direction: column;
        }

        .chat-main.active {
            display: flex;
        }

        .users-sidebar {
            background: #f8f9fa;
            width: 200px;
            padding: 15px;
            border-right: 2px solid #e9ecef;
            overflow-y: auto;
        }

        .users-header {
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
            font-size: 14px;
        }

        .user-item {
            padding: 8px 10px;
            margin-bottom: 5px;
            background: white;
            border-radius: 15px;
            font-size: 13px;
            display: flex;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .user-status {
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 8px;
        }

        .chat-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
            max-height: calc(90vh - 200px);
        }

        .message {
            margin-bottom: 15px;
            animation: slideIn 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.own {
            align-items: flex-end;
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 12px;
            opacity: 0.7;
        }

        .message.own .message-header {
            flex-direction: row-reverse;
        }

        .message-author {
            font-weight: 600;
            margin-right: 8px;
        }

        .message.own .message-author {
            margin-right: 0;
            margin-left: 8px;
        }

        .message-time {
            font-size: 11px;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 20px;
            word-wrap: break-word;
            position: relative;
        }

        .message.own .message-bubble {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message:not(.own) .message-bubble {
            background: white;
            color: #333;
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e1e8ed;
            display: flex;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .message-input:focus {
            border-color: #4facfe;
        }

        .send-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        .system-message {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin: 10px 0;
            font-style: italic;
            background: rgba(255, 255, 255, 0.7);
            padding: 8px 15px;
            border-radius: 15px;
            display: inline-block;
            margin: 10px auto;
        }

        .typing-indicator {
            padding: 10px 20px;
            font-size: 12px;
            color: #666;
            font-style: italic;
            display: none;
        }

        .message-count {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .chat-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }
            
            .users-sidebar {
                display: none;
            }
            
            .message-bubble {
                max-width: 85%;
            }
            
            .chat-main {
                flex-direction: column;
            }
        }

        .connection-status {
            padding: 5px 10px;
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            font-size: 12px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div>
                <div class="chat-title">Conference Chat Room</div>
                <div class="connection-status" id="connectionStatus">ðŸŸ¢ Connected</div>
            </div>
            <div class="chat-stats">
                <div id="onlineCount">0 users online</div>
                <div id="messageCount">0 messages</div>
            </div>
        </div>
        
        <div class="join-form" id="joinForm">
            <h2>Join Conference Chat</h2>
            <div class="form-group">
                <input type="text" class="name-input" id="nameInput" placeholder="Enter your name" maxlength="20">
            </div>
            <div class="form-group">
                <input type="text" class="room-input" id="roomInput" placeholder="Room ID (optional)" maxlength="20" value="general">
            </div>
            <button class="join-btn" id="joinBtn">Join Chat Room</button>
        </div>
        
        <div class="chat-main" id="chatMain">
            <div class="users-sidebar" id="usersSidebar">
                <div class="users-header">Online Users</div>
                <div id="usersList"></div>
            </div>
            <div class="chat-content">
                <div class="messages-container" id="messagesContainer">
                    <div class="message-count">Messages are stored up to 1000. Start chatting!</div>
                </div>
                <div class="typing-indicator" id="typingIndicator"></div>
                <div class="input-container">
                    <input type="text" class="message-input" id="messageInput" placeholder="Type your message... (Max 500 chars)" maxlength="500">
                    <button class="send-btn" id="sendBtn">Send</button>
                </div>
            </div>
        </div>
    </div>
<script>
        class MultiUserChat {
            constructor() {
                this.currentUser = null;
                this.currentRoom = 'general';
                this.messages = [];
                this.users = new Map();
                this.typingUsers = new Set();
                this.maxMessages = 1000;
                this.messageId = 1;
                
                this.initElements();
                this.bindEvents();
                this.simulateServerConnection();
                this.loadPersistentData();
            }
            
            initElements() {
                this.joinForm = document.getElementById('joinForm');
                this.chatMain = document.getElementById('chatMain');
                this.nameInput = document.getElementById('nameInput');
                this.roomInput = document.getElementById('roomInput');
                this.joinBtn = document.getElementById('joinBtn');
                this.messageInput = document.getElementById('messageInput');
                this.sendBtn = document.getElementById('sendBtn');
                this.messagesContainer = document.getElementById('messagesContainer');
                this.onlineCount = document.getElementById('onlineCount');
                this.messageCount = document.getElementById('messageCount');
                this.usersList = document.getElementById('usersList');
                this.connectionStatus = document.getElementById('connectionStatus');
                this.typingIndicator = document.getElementById('typingIndicator');
            }
            
            bindEvents() {
                // Add debug logging
                console.log('Binding events...');
                
                this.joinBtn.addEventListener('click', (e) => {
                    console.log('Join button clicked');
                    e.preventDefault();
                    this.joinChat();
                });
                
                this.nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.roomInput.focus();
                    }
                });
                
                this.roomInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.joinChat();
                    }
                });
                
                this.sendBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.sendMessage();
                });
                
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                this.messageInput.addEventListener('input', () => this.handleTyping());
                
                console.log('Events bound successfully');
            }
            
            loadPersistentData() {
                // Simulate loading existing messages and users
                const sampleMessages = [
                    {
                        id: this.messageId++,
                        text: "Welcome to the conference chat! Feel free to introduce yourself.",
                        author: "System Admin",
                        authorId: "admin",
                        timestamp: new Date(Date.now() - 300000),
                        room: this.currentRoom,
                        own: false
                    },
                    {
                        id: this.messageId++,
                        text: "Hi everyone! Excited to be here for the conference.",
                        author: "Sarah Johnson",
                        authorId: "sarah_j",
                        timestamp: new Date(Date.now() - 240000),
                        room: this.currentRoom,
                        own: false
                    },
                    {
                        id: this.messageId++,
                        text: "Great turnout today! Looking forward to the sessions.",
                        author: "Mike Chen",
                        authorId: "mike_c",
                        timestamp: new Date(Date.now() - 180000),
                        room: this.currentRoom,
                        own: false
                    }
                ];
                
                this.messages = sampleMessages;
                
                // Add sample users
                this.users.set("sarah_j", { name: "Sarah Johnson", joinedAt: new Date(Date.now() - 300000), active: true });
                this.users.set("mike_c", { name: "Mike Chen", joinedAt: new Date(Date.now() - 250000), active: true });
                this.users.set("admin", { name: "System Admin", joinedAt: new Date(Date.now() - 400000), active: true });
                
                this.updateStats();
            }
            
            simulateServerConnection() {
                // Simulate connection to server
                setTimeout(() => {
                    this.connectionStatus.innerHTML = 'ðŸŸ¢ Connected to server';
                }, 1000);
                
                // Simulate periodic new users joining
                setInterval(() => {
                    if (Math.random() < 0.2) {
                        this.simulateUserJoin();
                    }
                }, 15000);
                
                // Simulate random messages from other users
                setInterval(() => {
                    if (Math.random() < 0.3 && this.currentUser) {
                        this.simulateRandomMessage();
                    }
                }, 8000);
            }
            
            joinChat() {
                console.log('joinChat called');
                const name = this.nameInput.value.trim();
                const room = this.roomInput.value.trim() || 'general';
                
                console.log('Name:', name, 'Room:', room);
                
                if (!name) {
                    alert('Please enter your name');
                    this.nameInput.focus();
                    return;
                }
                
                if (name.length < 2) {
                    alert('Name must be at least 2 characters');
                    this.nameInput.focus();
                    return;
                }
                
                this.currentUser = {
                    name: name,
                    id: 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    joinedAt: new Date(),
                    room: room
                };
                
                console.log('User created:', this.currentUser);
                
                this.currentRoom = room;
                this.users.set(this.currentUser.id, {
                    name: this.currentUser.name,
                    joinedAt: this.currentUser.joinedAt,
                    active: true
                });
                
                console.log('Hiding join form, showing chat');
                this.joinForm.style.display = 'none';
                this.chatMain.classList.add('active');
                
                // Wait a bit then focus
                setTimeout(() => {
                    if (this.messageInput) {
                        this.messageInput.focus();
                    }
                }, 100);
                
                // Load existing messages for this user
                this.renderAllMessages();
                this.addSystemMessage(`${this.currentUser.name} joined the chat room: ${room}`);
                this.updateStats();
                this.updateUsersList();
                
                console.log('Join process completed');
            }
            
            sendMessage() {
                const text = this.messageInput.value.trim();
                if (!text) return;
                
                const message = {
                    id: this.messageId++,
                    text: text,
                    author: this.currentUser.name,
                    authorId: this.currentUser.id,
                    timestamp: new Date(),
                    room: this.currentRoom,
                    own: true
                };
                
                this.addMessageToStore(message);
                this.addMessageToDOM(message);
                this.messageInput.value = '';
                this.updateStats();
                
                // Simulate message broadcast to other users
                this.simulateMessageResponse(text);
            }
            
            addMessageToStore(message) {
                this.messages.push(message);
                
                // Keep only last 1000 messages
                if (this.messages.length > this.maxMessages) {
                    const removed = this.messages.splice(0, this.messages.length - this.maxMessages);
                    console.log(`Removed ${removed.length} old messages. Keeping last ${this.maxMessages} messages.`);
                }
            }
            
            renderAllMessages() {
                this.messagesContainer.innerHTML = '<div class="message-count">Loading previous messages...</div>';
                
                setTimeout(() => {
                    this.messagesContainer.innerHTML = '';
                    
                    // Show message count info
                    const countInfo = document.createElement('div');
                    countInfo.className = 'message-count';
                    countInfo.textContent = `Showing ${this.messages.length} messages (max 1000 stored)`;
                    this.messagesContainer.appendChild(countInfo);
                    
                    this.messages.forEach(message => {
                        this.addMessageToDOM(message);
                    });
                    
                    this.scrollToBottom();
                }, 500);
            }
            
            addMessageToDOM(message) {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${message.own ? 'own' : ''}`;
                messageEl.dataset.messageId = message.id;
                
                messageEl.innerHTML = `
                    <div class="message-header">
                        <span class="message-author">${this.escapeHtml(message.author)}</span>
                        <span class="message-time">${this.formatTime(message.timestamp)}</span>
                    </div>
                    <div class="message-bubble">${this.escapeHtml(message.text)}</div>
                `;
                
                this.messagesContainer.appendChild(messageEl);
                this.scrollToBottom();
            }
            
            addSystemMessage(text) {
                const messageEl = document.createElement('div');
                messageEl.className = 'system-message';
                messageEl.textContent = text;
                this.messagesContainer.appendChild(messageEl);
                this.scrollToBottom();
            }
            
            simulateUserJoin() {
                const names = ['Alex Rivera', 'Emma Watson', 'David Kim', 'Lisa Zhang', 'James Wilson', 'Ana Garcia'];
                const randomName = names[Math.floor(Math.random() * names.length)];
                
                const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
                this.users.set(userId, {
                    name: randomName,
                    joinedAt: new Date(),
                    active: true
                });
                
                this.addSystemMessage(`${randomName} joined the chat`);
                this.updateStats();
                this.updateUsersList();
            }
            
            simulateRandomMessage() {
                const activeUsers = Array.from(this.users.entries())
                    .filter(([id, user]) => user.active && id !== this.currentUser?.id)
                    .filter(([id, user]) => user.name !== 'System Admin');
                
                if (activeUsers.length === 0) return;
                
                const [userId, user] = activeUsers[Math.floor(Math.random() * activeUsers.length)];
                
                const casualMessages = [
                    "Thanks for the great insights everyone!",
                    "Really enjoying this discussion ðŸ‘",
                    "Has anyone tried the networking app?",
                    "Looking forward to the next session",
                    "Great points being made here",
                    "This conference is fantastic!",
                    "Anyone else taking notes? ðŸ“",
                    "The speakers have been amazing",
                    "Love the interactive format",
                    "What did everyone think of the last talk?",
                    "Coffee break was much needed â˜•",
                    "Who else is staying for the evening event?",
                    "The venue is incredible!",
                    "Met some amazing people today",
                    "This chat is so helpful for staying connected"
                ];
                
                const message = {
                    id: this.messageId++,
                    text: casualMessages[Math.floor(Math.random() * casualMessages.length)],
                    author: user.name,
                    authorId: userId,
                    timestamp: new Date(),
                    room: this.currentRoom,
                    own: false
                };
                
                this.addMessageToStore(message);
                this.addMessageToDOM(message);
                this.updateStats();
            }
            
            simulateMessageResponse(userMessage) {
                // Simulate someone responding to user's message
                setTimeout(() => {
                    const activeUsers = Array.from(this.users.entries())
                        .filter(([id, user]) => user.active && id !== this.currentUser?.id)
                        .filter(([id, user]) => user.name !== 'System Admin');
                    
                    if (activeUsers.length === 0) return;
                    
                    const [userId, user] = activeUsers[Math.floor(Math.random() * activeUsers.length)];
                    
                    const responses = [
                        "That's a great point!",
                        "I completely agree with that",
                        "Thanks for sharing that insight",
                        "Really interesting perspective",
                        "I hadn't thought of it that way",
                        "Absolutely! ðŸ’¯",
                        "Could you elaborate on that?",
                        "That's exactly what I was thinking",
                        "Great question!",
                        "Very insightful, thanks!"
                    ];
                    
                    const response = {
                        id: this.messageId++,
                        text: responses[Math.floor(Math.random() * responses.length)],
                        author: user.name,
                        authorId: userId,
                        timestamp: new Date(),
                        room: this.currentRoom,
                        own: false
                    };
                    
                    this.addMessageToStore(response);
                    this.addMessageToDOM(response);
                    this.updateStats();
                }, 1000 + Math.random() * 3000);
            }
            
            updateUsersList() {
                this.usersList.innerHTML = '';
                
                const sortedUsers = Array.from(this.users.entries())
                    .sort((a, b) => b[1].joinedAt - a[1].joinedAt);
                
                sortedUsers.forEach(([id, user]) => {
                    const userEl = document.createElement('div');
                    userEl.className = 'user-item';
                    userEl.innerHTML = `
                        <div class="user-status"></div>
                        <span>${this.escapeHtml(user.name)}</span>
                    `;
                    this.usersList.appendChild(userEl);
                });
            }
            
            updateStats() {
                this.onlineCount.textContent = `${this.users.size} users online`;
                this.messageCount.textContent = `${this.messages.length}/1000 messages`;
            }
            
            handleTyping() {
                // In a real implementation, this would notify other users
                clearTimeout(this.typingTimeout);
                this.typingTimeout = setTimeout(() => {
                    // Stop showing typing indicator
                }, 1000);
            }
            
            scrollToBottom() {
                setTimeout(() => {
                    this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
                }, 100);
            }
            
            formatTime(date) {
                return date.toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: true 
                });
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }
        
        // Initialize the multi-user chat
        document.addEventListener('DOMContentLoaded', () => {
            new MultiUserChat();
        });
    </script>
</body>
</html>
    